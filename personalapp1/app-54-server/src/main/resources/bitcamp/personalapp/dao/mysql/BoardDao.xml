<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitcamp.personalapp.dao.BoardDao">

<resultMap type="Board" id="boardMap">
  <id column="board_no" property="no"/>
  <result column="title" property="title"/>
  <result column="content" property="content"/>
  <result column="view_count" property="viewCount"/>
  <result column="created_date" property="createdDate"/>
  
  <association property="writer" javaType="bitcamp.personalapp.vo.Visit">
    <id column="visit_no" property="no"/>
    <result column="name" property="name"/>
  </association>
  
</resultMap>

  <insert id="insert" parameterType="board">
    insert into personalapp_board(title,content,writer)
     values(#{title},#{content},#{writer.no})
  </insert>
  
  <select id="findAll" parameterType="int" resultMap="boardMap">
    select
      b.Board_no,
      b.title, 
      b.view_count,
      b.created_date, 
      v.visit_No, 
      v.name 
      from
        personalapp_board b inner join personalapp_visit v on b.writer=v.visit_no
      order by 
        board_no desc
  </select>
  
  <select id="findBy" parameterType="map" resultMap="boardMap">
  select
    b.Board_no,
     b.title, 
     b.content,
     b.view_count, 
     b.created_date, 
     v.visit_No, 
     v.name
   from
     personalapp_board b inner join personalapp_visit v on b.writer=v.visit_no
   where board_no=#{boardNo}
  </select>
  
  <update id="update" parameterType="board">
  update 
  personalapp_board set
  title=#{title},
  content=#{content}
   where board_no=#{no}
   and writer=#{writer.no}
  </update>
  
  <update id="updateCount" parameterType="board">
    update personalapp_board set
      view_count=#{viewCount}
    where
      board_no=#{no}
  </update>
  
  <delete id="delete" parameterType="board">
  delete from personalapp_board
  where board_no=#{no} 
  and writer=#{writer.no}
  </delete>
  
</mapper>